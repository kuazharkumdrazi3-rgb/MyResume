<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Norhaslini | Quality Talent Tree</title>
  <style>
    :root {
      --bg-dark: #050812;
      --bg-panel: #0c101c;
      --bg-panel-soft: #15192a;
      --accent: #f2c94c;
      --accent-soft: rgba(242, 201, 76, 0.4);
      --accent-partial: #56ccf2;
      --accent-locked: #4f4f4f;
      --text-main: #f7f7f7;
      --text-muted: #9ea3b8;
      --text-soft: #c3cadb;
      --node-size: 54px;
      --node-radius: 50%;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, sans-serif;
      color: var(--text-main);
      background: radial-gradient(circle at top, #20263c 0, #050812 55%);
    }

    .app {
      display: flex;
      height: 100vh;
      padding: 16px 20px;
      gap: 16px;
    }

    .panel {
      background: linear-gradient(145deg, #0c101c, #050812);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    .left-panel {
      flex: 1.4;
      display: flex;
      flex-direction: column;
      padding: 16px 18px;
      position: relative;
      overflow: hidden;
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px 18px;
      background: radial-gradient(circle at top left, #1a2035 0, #050812 60%);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .panel-header h1,
    .panel-header h2 {
      margin: 0;
      font-size: 16px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .panel-header span.badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .tree-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .tree-meta span.dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
    }

    .tree-meta .dot-unlocked {
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent-soft);
    }

    .tree-meta .dot-partial {
      background: var(--accent-partial);
      box-shadow: 0 0 8px rgba(86, 204, 242, 0.4);
    }

    .tree-meta .dot-locked {
      background: var(--accent-locked);
    }

    .tree-container {
      position: relative;
      flex: 1;
      margin-top: 6px;
      border-radius: 16px;
      background: radial-gradient(circle at center, #15192a 0, #050812 65%);
      overflow: hidden;
      isolation: isolate;
    }

    .tree-grid-overlay {
      position: absolute;
      inset: 0;
      background-image: radial-gradient(
          circle at center,
          rgba(255, 255, 255, 0.04) 0,
          transparent 65%
        ),
        linear-gradient(
          rgba(255, 255, 255, 0.03) 1px,
          transparent 1px
        ),
        linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.03) 1px,
          transparent 1px
        );
      background-size: 100% 100%, 60px 60px, 60px 60px;
      opacity: 0.65;
      pointer-events: none;
    }

    .tree-nodes {
      position: absolute;
      inset: 16px;
    }

    .tree-connections {
      position: absolute;
      inset: 16px;
      pointer-events: none;
    }

    svg.tree-connections {
      width: calc(100% - 32px);
      height: calc(100% - 32px);
    }

    .node {
      position: absolute;
      transform: translate(-50%, -50%);
      text-align: center;
      font-size: 11px;
      cursor: pointer;
      max-width: 120px;
    }

    .node.locked { cursor: default; }

    .node-circle {
      width: var(--node-size);
      height: var(--node-size);
      border-radius: var(--node-radius);
      margin: 0 auto 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: radial-gradient(circle at 30% 0, #212948 0, #050814 70%);
      transition: transform 0.18s ease-out, box-shadow 0.18s ease-out,
        border-color 0.18s ease-out;
    }

    .node.unlocked .node-circle {
      border-color: rgba(242, 201, 76, 0.9);
      box-shadow: 0 0 14px var(--accent-soft), 0 0 28px rgba(0, 0, 0, 0.75);
    }

    .node.partial .node-circle {
      border-color: rgba(86, 204, 242, 0.9);
      box-shadow: 0 0 10px rgba(86, 204, 242, 0.35);
    }

    .node.locked .node-circle {
      border-color: rgba(255, 255, 255, 0.06);
      background: radial-gradient(circle at 40% 0, #141827 0, #050812 70%);
      box-shadow: none;
    }

    .node:hover.unlocked .node-circle,
    .node:hover.partial .node-circle {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 0 20px var(--accent-soft), 0 0 32px rgba(0, 0, 0, 0.8);
    }

    .node-short {
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .node.locked .node-short { opacity: 0.45; }

    .node-padlock {
      position: absolute;
      right: -4px;
      bottom: -4px;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #11131f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.14);
    }

    .node-name {
      color: var(--text-muted);
      font-size: 11px;
      line-height: 1.3;
    }

    .node.core .node-circle {
      width: 70px;
      height: 70px;
      border-width: 2px;
      background: radial-gradient(circle at 30% 0, #f2c94c 0, #c58c1d 30%, #050812 85%);
      box-shadow: 0 0 32px rgba(242, 201, 76, 0.75);
    }

    .node.core .node-short {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #111010;
    }

    .node.core .node-name {
      color: var(--text-soft);
      font-weight: 500;
    }

    line.connection {
      stroke: rgba(255, 255, 255, 0.14);
      stroke-width: 1.2;
    }

    line.connection-highlight {
      stroke: rgba(242, 201, 76, 0.6);
      stroke-width: 1.6;
    }

    /* Right panel */

    .profile-card {
      background: radial-gradient(circle at top, #1c2237 0, #050812 70%);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 12px 14px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.2fr);
      gap: 10px;
    }

    .profile-main h2 {
      margin: 0 0 2px;
      font-size: 17px;
    }

    .profile-main p.role {
      margin: 0 0 6px;
      font-size: 13px;
      color: var(--text-soft);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
    }

    .profile-meta {
      font-size: 11px;
      color: var(--text-muted);
      display: grid;
      gap: 4px;
    }

    .profile-meta span.label {
      color: var(--text-soft);
      font-size: 11px;
    }

    .skill-detail-card {
      flex: 1;
      background: var(--bg-panel-soft);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 10px 14px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-height: 0; /* penting untuk flex children scroll dengan elok */
    }

    .skill-detail-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }

    .skill-title {
      font-size: 15px;
      margin: 0;
    }

    .skill-branch {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .tier-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(242, 201, 76, 0.8);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      white-space: nowrap;
    }

    .tier-badge.locked {
      border-color: rgba(255, 255, 255, 0.18);
      color: var(--text-muted);
    }

    .skill-status {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .skill-description {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.4;
      margin-bottom: 4px;
    }

    /* Tier table â€“ full height in card */
    .tier-table-wrapper {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      background: rgba(3, 5, 12, 0.7);
      overflow-y: auto;
      flex: 1;              /* ambil baki ruang dalam card */
      display: flex;
    }

    table.tier-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      color: var(--text-muted);
    }

    .tier-table th,
    .tier-table td {
      padding: 4px 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      vertical-align: top;
    }

    .tier-table th {
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: var(--text-soft);
      background: rgba(255, 255, 255, 0.01);
    }

    .tier-table tr:last-child th,
    .tier-table tr:last-child td {
      border-bottom: none;
    }

    .tier-label {
      font-weight: 600;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .tier-status-chip {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      font-size: 10px;
      margin-right: 4px;
    }

    .tier-status-chip.unlocked {
      border-color: rgba(242, 201, 76, 0.9);
      color: var(--accent);
    }

    .tier-status-chip.partial {
      border-color: rgba(86, 204, 242, 0.9);
      color: var(--accent-partial);
    }

    .tier-status-chip.locked {
      border-color: rgba(255, 255, 255, 0.18);
      color: var(--text-muted);
    }

    .tier-row-active {
      background: rgba(242, 201, 76, 0.06);
    }

    .tier-row-active td,
    .tier-row-active th {
      border-bottom-color: rgba(242, 201, 76, 0.15);
    }

    .stats-card {
      background: rgba(10, 12, 23, 0.9);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 10px 14px;
      font-size: 11px;
      color: var(--text-muted);
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 8px;
    }

    .stats-group-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .stats-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .stats-key { color: var(--text-soft); }
    .stats-value { color: var(--text-muted); }

    @media (max-width: 1024px) {
      .app {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
        overflow-y: auto;
      }
      body { overflow: auto; }
    }
  </style>
</head>
<body>
<div class="app">
  <section class="panel left-panel">
    <div class="panel-header">
      <h1>Talent Tree</h1>
      <span class="badge" id="current-tier-badge">Tier 5 Â· Quality Manager</span>
    </div>
    <div class="tree-meta">
      <span><span class="dot dot-unlocked"></span>Unlocked</span>
      <span><span class="dot dot-partial"></span>Growing (Tier 5)</span>
      <span><span class="dot dot-locked"></span>Future (Tier 6)</span>
      <span id="skill-stats"></span>
    </div>
    <div class="tree-container">
      <div class="tree-grid-overlay"></div>
      <svg class="tree-connections"></svg>
      <div class="tree-nodes"></div>
    </div>
  </section>

  <section class="panel right-panel">
    <div class="profile-card">
      <div class="profile-main">
        <h2>Norhaslini Abd Ghaffar</h2>
        <p class="role">Quality / QAâ€“QC Lead Â· Current Tier: <strong>5 â€“ Quality Manager</strong></p>
        <div class="pill-row">
          <span class="pill">10+ years in Quality</span>
          <span class="pill">Manufacturing Â· Chemical & Coatings</span>
          <span class="pill">SPC Â· 7 QC Tools Â· CAPA</span>
        </div>
      </div>
      <div class="profile-meta">
        <div>
          <span class="label">Career Path</span><br />
          Inspector â†’ Supervisor â†’ Executive â†’ Engineer â†’ Manager
        </div>
        <div>
          <span class="label">Certs & Training</span><br />
          Lean Six Sigma Black Belt, ISO Internal Auditor, SAP QM/MM/PP
        </div>
      </div>
    </div>

    <div class="skill-detail-card">
      <div class="skill-detail-header">
        <div>
          <p class="skill-branch" id="skill-branch">Select a node to view details</p>
          <h3 class="skill-title" id="skill-title">Quality Career Core</h3>
        </div>
        <div class="tier-badge" id="skill-tier">Tier 5 Â· Manager</div>
      </div>
      <div class="skill-status" id="skill-status"></div>
      <div class="skill-description" id="skill-description">
        Hover or click any glowing node in the talent tree.  
        Table below shows how your skills are distributed by tier.
      </div>
      <div class="tier-table-wrapper">
        <table class="tier-table">
          <thead>
          <tr>
            <th>Tier</th>
            <th>Status</th>
            <th>Key skills in this tier</th>
          </tr>
          </thead>
          <tbody id="tier-table-body">
          <!-- filled by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <div class="stats-card">
      <div>
        <div class="stats-group-title">Quality Expertise</div>
        <div class="stats-row">
          <span class="stats-key">Core QMS</span>
          <span class="stats-value">ISO 9001, audits, CAPA</span>
        </div>
        <div class="stats-row">
          <span class="stats-key">Lab & Data</span>
          <span class="stats-value">SPC, 7 QC Tools, trend analysis</span>
        </div>
        <div class="stats-row">
          <span class="stats-key">Improvement</span>
          <span class="stats-value">Lean, FMEA, CI projects</span>
        </div>
      </div>
      <div>
        <div class="stats-group-title">Leadership Focus</div>
        <div class="stats-row">
          <span class="stats-key">Team</span>
          <span class="stats-value">QA/QC + Lab</span>
        </div>
        <div class="stats-row">
          <span class="stats-key">Style</span>
          <span class="stats-value">Supportive, data-informed, hands-on</span>
        </div>
        <div class="stats-row">
          <span class="stats-key">Next Tier</span>
          <span class="stats-value">Halal / HACCP / Medical Device certifications</span>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // ----- Talent tree data -----
  const skillTree = [
    {
      id: "core",
      name: "Quality Career Core",
      short: "CORE",
      branch: "Career Path",
      tier: 5,
      status: "unlocked",
      description:
        "End-to-end experience from Quality Inspector to Quality Manager, combining lab, systems, and people leadership into a single quality spine.",
      x: 50, y: 50, parent: null, core: true,
    },

    // Branch 1: Quality Systems & Compliance
    {
      id: "iso9001",
      name: "ISO 9001 QMS",
      short: "ISO 9001",
      branch: "Quality Systems & Compliance",
      tier: 4,
      status: "unlocked",
      description:
        "Implement, maintain and improve ISO 9001-based quality management systems, including risk-based thinking and process approach.",
      x: 25, y: 22, parent: "core",
    },
    {
      id: "internal-audit",
      name: "Internal Auditing",
      short: "Audit",
      branch: "Quality Systems & Compliance",
      tier: 4,
      status: "unlocked",
      description:
        "Plan and execute internal audits, report findings, and drive closure actions with process owners.",
      x: 16, y: 34, parent: "iso9001",
    },
    {
      id: "doc-control",
      name: "Documentation Control",
      short: "Docs",
      branch: "Quality Systems & Compliance",
      tier: 3,
      status: "unlocked",
      description:
        "Manage controlled documents, SOPs, work instructions and change history to ensure only the right version is in use.",
      x: 34, y: 34, parent: "iso9001",
    },
    {
      id: "capa-systems",
      name: "Deviation & CAPA",
      short: "CAPA",
      branch: "Quality Systems & Compliance",
      tier: 4,
      status: "unlocked",
      description:
        "Lead deviation investigation and CAPA lifecycle, from containment to effectiveness check.",
      x: 25, y: 46, parent: "doc-control",
    },
    {
      id: "risk-qms",
      name: "Risk-Based QMS",
      short: "Risk QMS",
      branch: "Quality Systems & Compliance",
      tier: 5,
      status: "unlocked",
      description:
        "Translate risk-based thinking into quality KPIs, controls and improvement priorities at plant level.",
      x: 25, y: 10, parent: "iso9001",
    },
    {
      id: "halal",
      name: "Halal Certification Management",
      short: "Halal",
      branch: "Quality Systems & Compliance",
      tier: 6,
      status: "locked",
      description:
        "Lead and maintain Halal certification and audit programmes for manufacturing operations.",
      x: 10, y: 15, parent: "risk-qms",
    },
    {
      id: "haccp",
      name: "HACCP / Food Safety",
      short: "HACCP",
      branch: "Quality Systems & Compliance",
      tier: 6,
      status: "locked",
      description:
        "Design and manage HACCP plans and food safety controls as part of an integrated quality system.",
      x: 40, y: 15, parent: "risk-qms",
    },
    {
      id: "iso13485",
      name: "ISO 13485 / Medical Device",
      short: "MedDev",
      branch: "Quality Systems & Compliance",
      tier: 6,
      status: "locked",
      description:
        "Implement quality system requirements for medical device manufacturing under ISO 13485.",
      x: 18, y: 60, parent: "capa-systems",
    },
    {
      id: "iso17025",
      name: "ISO 17025 Lab Accreditation",
      short: "17025",
      branch: "Quality Systems & Compliance",
      tier: 6,
      status: "locked",
      description:
        "Secure and maintain ISO 17025 accreditation for quality control laboratories.",
      x: 32, y: 60, parent: "capa-systems",
    },

    // Branch 2: Lab, Testing & Data
    {
      id: "lab-ops",
      name: "QC Lab Operations",
      short: "Lab Ops",
      branch: "Lab, Testing & Data",
      tier: 3,
      status: "unlocked",
      description:
        "Run day-to-day QC lab operations, including sampling, testing, safety and housekeeping.",
      x: 75, y: 22, parent: "core",
    },
    {
      id: "spc",
      name: "SPC & Process Monitoring",
      short: "SPC",
      branch: "Lab, Testing & Data",
      tier: 4,
      status: "unlocked",
      description:
        "Set up and interpret control charts, capability indices and trend analysis for critical processes.",
      x: 84, y: 34, parent: "lab-ops",
    },
    {
      id: "qc-tools",
      name: "7 QC Tools",
      short: "7 QC",
      branch: "Lab, Testing & Data",
      tier: 4,
      status: "unlocked",
      description:
        "Apply 7 QC tools to visualise variation, identify patterns and support problem solving.",
      x: 66, y: 34, parent: "lab-ops",
    },
    {
      id: "data-trend",
      name: "Data Trending & Reporting",
      short: "Trends",
      branch: "Lab, Testing & Data",
      tier: 4,
      status: "unlocked",
      description:
        "Transform lab and production data into simple dashboards and decision-ready summaries.",
      x: 75, y: 46, parent: "spc",
    },
    {
      id: "advanced-data",
      name: "Advanced Data Interpretation",
      short: "Adv Data",
      branch: "Lab, Testing & Data",
      tier: 5,
      status: "unlocked",
      description:
        "Use advanced analysis and digital tools to connect process signals with quality outcomes.",
      x: 75, y: 10, parent: "spc",
    },
    {
      id: "doe",
      name: "Design of Experiments (DoE)",
      short: "DoE",
      branch: "Lab, Testing & Data",
      tier: 5,
      status: "unlocked",
      description:
        "Plan and interpret structured experiments to optimise process and formulation settings.",
      x: 90, y: 15, parent: "advanced-data",
    },

    // Branch 3: Problem Solving & Improvement
    {
      id: "rca",
      name: "Root Cause Analysis",
      short: "RCA",
      branch: "Problem Solving & Improvement",
      tier: 4,
      status: "unlocked",
      description:
        "Lead structured root cause analysis using 5 Why, Fishbone and other techniques.",
      x: 25, y: 82, parent: "core",
    },
    {
      id: "fmea",
      name: "FMEA / PFMEA",
      short: "FMEA",
      branch: "Problem Solving & Improvement",
      tier: 4,
      status: "unlocked",
      description:
        "Use FMEA to assess risk, prioritise controls and document prevention actions.",
      x: 18, y: 68, parent: "rca",
    },
    {
      id: "ci-projects",
      name: "Continuous Improvement Projects",
      short: "CI",
      branch: "Problem Solving & Improvement",
      tier: 4,
      status: "unlocked",
      description:
        "Run cross-functional improvement projects, tracking savings, quality and delivery impact.",
      x: 32, y: 68, parent: "rca",
    },
    {
      id: "plant-strategy",
      name: "Plant-wide Quality Strategy",
      short: "Plant Q",
      branch: "Problem Solving & Improvement",
      tier: 6,
      status: "unlocked",
      description:
        "Shape and deploy plant-wide or regional quality strategy as part of a director-level role.",
      x: 10, y: 90, parent: "rca",
    },

    // Branch 4: Leadership & People
    {
      id: "team-lead",
      name: "Team Leadership (QA/QC/Lab)",
      short: "Team",
      branch: "Leadership & People",
      tier: 5,
      status: "unlocked",
      description:
        "Lead QA/QC and lab teams, balancing workload, coaching individuals and shielding them from noise.",
      x: 74, y: 82, parent: "core",
    },
    {
      id: "xf-comm",
      name: "Cross-functional Communication",
      short: "X-Comm",
      branch: "Leadership & People",
      tier: 3,
      status: "unlocked",
      description:
        "Align production, engineering and quality stakeholders with clear, direct and respectful communication.",
      x: 86, y: 70, parent: "team-lead",
    },
    {
      id: "coaching",
      name: "Coaching & Mentoring",
      short: "Coach",
      branch: "Leadership & People",
      tier: 4,
      status: "unlocked",
      description:
        "Coach junior staff on quality mindset, documentation and problem solving instead of only policing.",
      x: 62, y: 70, parent: "team-lead",
    },
    {
      id: "culture",
      name: "Quality Culture Building",
      short: "Culture",
      branch: "Leadership & People",
      tier: 5,
      status: "unlocked",
      description:
        "Shift team mindset from blame to prevention, using mistakes as learning instead of fear triggers.",
      x: 76, y: 94, parent: "team-lead",
    },
    {
      id: "director-lead",
      name: "Strategic Quality Leadership",
      short: "Director",
      branch: "Leadership & People",
      tier: 6,
      status: "locked",
      description:
        "Own regional or global quality agenda, budgets and stakeholder management at executive level.",
      x: 90, y: 90, parent: "team-lead",
    },
  ];

  const container = document.querySelector(".tree-container");
  const nodesLayer = container.querySelector(".tree-nodes");
  const svg = container.querySelector(".tree-connections");

  const detailTitle = document.getElementById("skill-title");
  const detailBranch = document.getElementById("skill-branch");
  const detailTier = document.getElementById("skill-tier");
  const detailStatus = document.getElementById("skill-status");
  const detailDesc = document.getElementById("skill-description");
  const skillStats = document.getElementById("skill-stats");
  const tierTableBody = document.getElementById("tier-table-body");

  let nodePositionCache = {};

  function tierLabel(tier) {
    switch (tier) {
      case 1: return "Tier 1 Â· Inspector";
      case 2: return "Tier 2 Â· Supervisor";
      case 3: return "Tier 3 Â· Executive";
      case 4: return "Tier 4 Â· Engineer";
      case 5: return "Tier 5 Â· Manager";
      case 6: return "Tier 6 Â· Director (Future)";
      default: return "Tier ?";
    }
  }

  function statusLabel(status) {
    if (status === "unlocked") return "Unlocked â€“ actively used in past roles.";
    if (status === "partial")
      return "Growing â€“ currently strengthening exposure at manager level.";
    return "Future target â€“ mapped for next tier of career growth.";
  }

  function statusShort(status) {
    if (status === "unlocked") return "Unlocked";
    if (status === "partial") return "Growing";
    return "Future";
  }

  function renderNodes() {
    nodesLayer.innerHTML = "";
    nodePositionCache = {};
    const bounds = nodesLayer.getBoundingClientRect();
    const width = bounds.width;
    const height = bounds.height;

    skillTree.forEach((node) => {
      const el = document.createElement("div");
      el.classList.add("node");
      if (node.core) el.classList.add("core");
      el.classList.add(node.status);
      el.dataset.id = node.id;

      const circle = document.createElement("div");
      circle.className = "node-circle";

      const short = document.createElement("div");
      short.className = "node-short";
      short.textContent = node.short;
      circle.appendChild(short);

      if (node.status === "locked") {
        const lock = document.createElement("div");
        lock.className = "node-padlock";
        lock.textContent = "ðŸ”’";
        circle.appendChild(lock);
      }

      const name = document.createElement("div");
      name.className = "node-name";
      name.textContent = node.name;

      el.style.left = node.x + "%";
      el.style.top = node.y + "%";

      el.appendChild(circle);
      el.appendChild(name);

      if (node.status !== "locked") {
        el.addEventListener("click", () => selectNode(node.id));
        el.addEventListener("mouseenter", () => selectNode(node.id, true));
      } else {
        el.addEventListener("mouseenter", () => selectNode(node.id, true));
      }

      nodesLayer.appendChild(el);

      const centerX = (node.x / 100) * width;
      const centerY = (node.y / 100) * height;
      nodePositionCache[node.id] = { x: centerX, y: centerY };
    });
  }

  function renderConnections() {
    svg.innerHTML = "";
    const bounds = nodesLayer.getBoundingClientRect();
    const width = bounds.width;
    const height = bounds.height;
    svg.setAttribute("viewBox", `0 0 ${width} ${height}`);

    skillTree.forEach((node) => {
      if (!node.parent) return;
      const from = nodePositionCache[node.parent];
      const to = nodePositionCache[node.id];
      if (!from || !to) return;

      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.classList.add("connection");
      if (node.status === "unlocked" || node.status === "partial") {
        line.classList.add("connection-highlight");
      }
      line.setAttribute("x1", from.x);
      line.setAttribute("y1", from.y);
      line.setAttribute("x2", to.x);
      line.setAttribute("y2", to.y);
      svg.appendChild(line);
    });
  }

  function updateTierTable(activeTier = null) {
    const tiers = [3, 4, 5, 6]; // fokus tier yang nampak
    tierTableBody.innerHTML = "";

    tiers.forEach((tier) => {
      const tierNodes = skillTree.filter((n) => n.tier === tier);
      if (!tierNodes.length) return;

      const unlocked = tierNodes.filter((n) => n.status === "unlocked");
      const partial = tierNodes.filter((n) => n.status === "partial");
      const locked = tierNodes.filter((n) => n.status === "locked");

      const tr = document.createElement("tr");
      if (tier === activeTier) tr.classList.add("tier-row-active");

      const tdTier = document.createElement("th");
      tdTier.className = "tier-label";
      tdTier.textContent = tierLabel(tier).replace("Tier ", "T");

      const tdStatus = document.createElement("td");
      if (unlocked.length) {
        const chip = document.createElement("span");
        chip.className = "tier-status-chip unlocked";
        chip.textContent = `${unlocked.length} unlocked`;
        tdStatus.appendChild(chip);
      }
      if (partial.length) {
        const chip = document.createElement("span");
        chip.className = "tier-status-chip partial";
        chip.textContent = `${partial.length} growing`;
        tdStatus.appendChild(chip);
      }
      if (locked.length) {
        const chip = document.createElement("span");
        chip.className = "tier-status-chip locked";
        chip.textContent = `${locked.length} future`;
        tdStatus.appendChild(chip);
      }

      const tdSkills = document.createElement("td");
      const names = tierNodes.map((n) => n.name);
      tdSkills.textContent = names.join(", ");

      tr.appendChild(tdTier);
      tr.appendChild(tdStatus);
      tr.appendChild(tdSkills);
      tierTableBody.appendChild(tr);
    });
  }

  function selectNode(id, hoverOnly = false) {
    const node = skillTree.find((n) => n.id === id);
    if (!node) return;

    detailTitle.textContent = node.name;
    detailBranch.textContent = node.branch;
    detailTier.textContent = tierLabel(node.tier);
    detailDesc.textContent = node.description;
    detailStatus.textContent =
      statusShort(node.status) + " Â· " + statusLabel(node.status);

    if (node.status === "locked") {
      detailTier.classList.add("locked");
    } else {
      detailTier.classList.remove("locked");
    }

    const allNodes = nodesLayer.querySelectorAll(".node");
    allNodes.forEach((el) => el.classList.remove("selected"));
    const selectedEl = nodesLayer.querySelector(`[data-id="${id}"]`);
    if (selectedEl && !hoverOnly) {
      selectedEl.classList.add("selected");
    }

    updateTierTable(node.tier);
  }

  function updateStats() {
    const total = skillTree.length;
    const unlocked = skillTree.filter((n) => n.status === "unlocked").length;
    const partial = skillTree.filter((n) => n.status === "partial").length;
    const locked = total - unlocked - partial;

    skillStats.textContent = `${unlocked + partial}/${total} skills unlocked Â· ${locked} future`;
  }

  function renderAll() {
    renderNodes();
    renderConnections();
    updateStats();
    updateTierTable();
    selectNode("core");
  }

  window.addEventListener("resize", () => {
    renderNodes();
    renderConnections();
  });

  window.addEventListener("DOMContentLoaded", renderAll);
</script>
</body>
</html>
