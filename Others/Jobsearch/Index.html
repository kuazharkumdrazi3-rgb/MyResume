<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plant Visit Planner â€“ Dark</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#05070d; --bg-card:#151a24; --bg-card-soft:#1b2230;
      --border-soft:#252b3a; --accent:#59b5ff; --accent-soft:rgba(89,181,255,0.15);
      --text-main:#f5f7ff; --text-muted:#9aa4c0; --success:#2ecc71;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#151a24 0,#05070d 45%,#020308 100%);
      color:var(--text-main);
    }
    .page{max-width:1400px;margin:0 auto;padding:.75rem}
    h1{
      margin:0 0 .75rem;
      font-size:1.1rem; letter-spacing:.04em; text-transform:uppercase;
      color:var(--text-muted); display:flex; justify-content:space-between; align-items:center;
      gap:.75rem; flex-wrap:wrap;
    }

    .main-card{
      background:var(--bg-card);
      border-radius:16px;
      border:1px solid var(--border-soft);
      box-shadow:0 16px 40px rgba(0,0,0,.5);
      padding:.75rem;
    }
    .card-inner{
      background:var(--bg-card-soft);
      border-radius:12px;
      border:1px solid var(--border-soft);
      padding:.75rem;
      width:100%;
      display:flex;
      flex-direction:column;
      height:calc(100vh - 120px);
    }
    .card-title{
      font-size:.9rem; text-transform:uppercase; letter-spacing:.08em;
      color:var(--text-muted); margin-bottom:.35rem;
    }
    .subline{font-size:.78rem;color:var(--text-muted);margin-bottom:.4rem}

    .controls{
      display:flex; justify-content:space-between; align-items:center;
      gap:.5rem; margin-bottom:.55rem; flex-wrap:wrap;
    }
    .controls-left{display:flex;gap:.4rem;align-items:center;flex-wrap:wrap}

    .btn{
      border-radius:999px;
      border:1px solid var(--border-soft);
      background:#0f131d;
      padding:.25rem .7rem;
      color:var(--text-muted);
      font-size:.78rem;
      cursor:pointer;
      transition:all .2s;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      white-space:nowrap;
    }
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    .btn-primary{border-color:var(--accent);color:var(--accent);background:rgba(89,181,255,.05)}
    .btn:disabled{opacity:.45;cursor:not-allowed}

    .stats{font-size:.8rem;color:var(--text-muted)}
    .stats b{color:var(--accent)}

    .list{flex:1 1 auto;overflow-y:auto;padding-right:.25rem}

    .stop-row{
      display:flex; align-items:flex-start; gap:.55rem;
      padding:.55rem .45rem; margin-bottom:.2rem;
      border-radius:12px; cursor:pointer;
      border:1px solid transparent; transition:all .15s;
    }
    .stop-row:hover{background:#202738}
    .stop-row.selected{background:var(--accent-soft);border-color:var(--accent);transform:translateY(-1px)}
    .stop-row.visited{background:rgba(20,80,40,.35);opacity:.8}
    .stop-row.visited .company-name-main{ text-decoration:line-through; color:var(--text-muted); }

    .stop-number{
      width:30px;height:30px;border-radius:50%;background:#0d111c;
      display:flex;align-items:center;justify-content:center;
      font-size:.75rem;color:var(--accent);flex-shrink:0;margin-top:.1rem;
    }

    .company-block{flex:1 1 auto; min-width: 240px;}
    .company-name{font-size:.88rem;line-height:1.25;}
    .company-name-main{display:block;font-weight:650}
    .company-area{display:block;margin-top:.2rem;font-size:.75rem;color:var(--text-muted);line-height:1.35}
    .row-actions{margin-top:.45rem;display:flex;gap:.35rem;flex-wrap:wrap}

    .checkbox-wrap{flex-shrink:0;margin-top:.15rem}
    .checkbox-wrap input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent);cursor:pointer}

    .list::-webkit-scrollbar{width:6px}
    .list::-webkit-scrollbar-track{background:transparent}
    .list::-webkit-scrollbar-thumb{background:#343c4f;border-radius:3px}

    @media (max-width: 960px){
      .card-inner{height:75vh}
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>
      Plant Visit Planner
      <span class="stats" id="stats"></span>
    </h1>

    <div class="main-card">
      <div class="card-inner">
        <div class="card-title">Company List</div>
        <div class="subline">Tap a company to highlight it. Use the button under it to open Google Maps for directions (Google Maps will use your current location).</div>

        <div class="controls">
          <div class="controls-left">
            <button id="clearVisited" class="btn">Reset Visited</button>
          </div>
          <div class="stats" id="hint"></div>
        </div>

        <div class="list" id="plantList"></div>
      </div>
    </div>
  </div>

<script>
  // --- DATA (NO LAT/LNG USED) ---
  const plants = [
    { id: "aureumaex", order: 1, name: "Aureumaex Precision Plastics (M) Sdn Bhd", area: "Lot 136, Jalan Permata 1, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "ichikoh", order: 2, name: "Ichikoh (M) Sdn. Bhd.", area: "Lot 110, Jalan Permata 1/4, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "ouji_sekken", order: 3, name: "Ouji Sekken Manufacturing (M) Sdn. Bhd.", area: "Lot 759(B3), Nilai Industrial Estate, 71800 Nilai, Negeri Sembilan" },
    { id: "alps_electric", order: 4, name: "Alps Electric (Malaysia) Sdn Bhd - Nilai Plant", area: "Lot 109, Jalan Permata 1/4, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "k_plastics", order: 5, name: "K-Plastics Industries Sdn Bhd", area: "Lot 24, Jalan Permata 1/2, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "pca_group", order: 6, name: "PCA Group Sdn Bhd", area: "Lot 50, Jalan Permata 2, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "johnson_matthey", order: 7, name: "Johnson Matthey Sdn. Bhd.", area: "Lot 12, Jalan 2, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "meditech_gloves", order: 8, name: "Meditech Gloves Sdn. Bhd.", area: "Lot 23, Jalan Seriemas 1, Kota Seriemas, 71800 Nilai, Negeri Sembilan" },
    { id: "future_plastic", order: 9, name: "Future Plastic Industries Sdn. Bhd.", area: "Lot 1608, Jalan Nilai 3/10, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "jujutsu_industries", order: 10, name: "Jujutsu Industries Sdn Bhd", area: "Lot 83, Jalan Permata 2/3, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "polyplus_packages", order: 11, name: "Polyplus Packages Sdn. Bhd.", area: "Lot 18, Jalan Permata 1/1, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "jebsen_jessen", order: 12, name: "Jebsen & Jessen Packaging Sdn Bhd", area: "Lot 3297, Jalan Permata 2/1, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "lti_industries", order: 13, name: "LTI Industries Sdn Bhd", area: "Lot 16, Jalan Permata 1, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "harta_packaging", order: 14, name: "Harta Packaging Industries (Selangor) Sdn. Bhd.", area: "Lot 6, Jalan Permata 2, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "skf_bearing", order: 15, name: "SKF Bearing Industries (M) Sdn Bhd", area: "Lot 79, Jalan Permata 2, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "akzo_nobel", order: 16, name: "Akzo Nobel Paints (Malaysia) Sdn Bhd", area: "Lot 5827, Jalan Permata 1, Arab Malaysian Industrial Park, 71800 Nilai, Negeri Sembilan" },
    { id: "mapei_nilai", order: 17, name: "Mapei Malaysia Nilai Plant", area: "D3A, Lot 28, Jalan Industri 3/4, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "gf_one", order: 18, name: "GF One Chemicals Sdn. Bhd.", area: "Lot 12A, Jalan Nilai 3/7, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "dansoon", order: 19, name: "Dansoon Chemicals Sdn. Bhd.", area: "No. 5, Jalan Nilai 3/8, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "chuanplus", order: 20, name: "Chuanplus Industries Sdn. Bhd.", area: "Lot 27, Jalan Nilai 3/1, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "av_manufacturing", order: 21, name: "AV Manufacturing Sdn. Bhd.", area: "Lot 19, Jalan Nilai 3/5, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },
    { id: "yec_chemical", order: 22, name: "YEC Chemical Compounds Sdn Bhd", area: "No. 16, Jalan Nilai 3/2, Kawasan Perindustrian Nilai 3, 71800 Nilai, Negeri Sembilan" },

    // NOTE: paste the rest of your array here (same structure: id, order, name, area)
  ];

  // --- STATE ---
  const VISITED_KEY = "plant_visit_dark_visited_v3";
  const listEl = document.getElementById("plantList");
  const statsEl = document.getElementById("stats");
  const hintEl = document.getElementById("hint");
  let visited = {};
  let selectedId = null;

  // --- INIT ---
  loadVisited();
  buildList();
  updateStats();

  // --- STORAGE ---
  function loadVisited() {
    try {
      const s = localStorage.getItem(VISITED_KEY);
      visited = s ? JSON.parse(s) : {};
    } catch { visited = {}; }
  }
  function saveVisited() {
    localStorage.setItem(VISITED_KEY, JSON.stringify(visited));
  }

  // --- MAP OPENERS (LET GOOGLE MAPS HANDLE LOCATION + DISTANCE) ---
  // We use destination as "Company Name + Address" so Maps can disambiguate.
  function buildQuery(plant) {
    return `${plant.name} ${plant.area}`.trim();
  }

  function openDirections(plant) {
    const q = encodeURIComponent(buildQuery(plant));

    const ua = navigator.userAgent || "";
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);

    // Web fallback (always works; Maps will ask/assume current location)
    const webUrl = `https://www.google.com/maps/dir/?api=1&destination=${q}&travelmode=driving`;

    // Android intent -> Google Maps app
    if (isAndroid) {
      const intentUrl = `intent://maps.google.com/maps?daddr=${q}#Intent;scheme=https;package=com.google.android.apps.maps;end`;
      attemptOpen(intentUrl, webUrl);
      return;
    }

    // iOS Google Maps scheme (opens Google Maps if installed)
    if (isIOS) {
      const appUrl = `comgooglemaps://?daddr=${q}&directionsmode=driving`;
      attemptOpen(appUrl, webUrl);
      return;
    }

    // Desktop
    window.open(webUrl, "_blank");
  }

  function attemptOpen(appUrl, webUrl) {
    const started = Date.now();
    window.location.href = appUrl;
    setTimeout(() => {
      if (Date.now() - started < 1500) {
        window.open(webUrl, "_blank");
      }
    }, 900);
  }

  // --- UI ---
  function buildList() {
    listEl.innerHTML = "";

    // Sort by your fixed "order"
    const sorted = [...plants].sort((a,b) => (a.order ?? 9999) - (b.order ?? 9999));

    sorted.forEach((plant) => {
      const row = document.createElement("div");
      row.className = "stop-row";
      if (visited[plant.id]) row.classList.add("visited");
      if (plant.id === selectedId) row.classList.add("selected");

      const num = document.createElement("div");
      num.className = "stop-number";
      num.textContent = plant.order ?? "";

      const block = document.createElement("div");
      block.className = "company-block";

      const name = document.createElement("div");
      name.className = "company-name";

      const main = document.createElement("span");
      main.className = "company-name-main";
      main.textContent = plant.name || "(No name)";
      name.appendChild(main);

      const area = document.createElement("span");
      area.className = "company-area";
      area.textContent = plant.area || "";
      name.appendChild(area);

      const actions = document.createElement("div");
      actions.className = "row-actions";

      const btnDir = document.createElement("button");
      btnDir.className = "btn btn-primary";
      btnDir.type = "button";
      btnDir.textContent = "Open Directions";
      btnDir.onclick = (e) => {
        e.stopPropagation();
        openDirections(plant);
      };

      actions.appendChild(btnDir);
      block.appendChild(name);
      block.appendChild(actions);

      const cbWrap = document.createElement("div");
      cbWrap.className = "checkbox-wrap";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!visited[plant.id];
      cb.title = "Mark visited";
      cb.onclick = (e) => {
        e.stopPropagation();
        visited[plant.id] = cb.checked;
        saveVisited();
        row.classList.toggle("visited", cb.checked);
        updateStats();
      };
      cbWrap.appendChild(cb);

      row.appendChild(num);
      row.appendChild(block);
      row.appendChild(cbWrap);

      row.onclick = () => {
        selectedId = plant.id;
        hintEl.innerHTML = `Selected: <b style="color:var(--accent)">${escapeHtml(plant.name || "")}</b>`;
        buildList();
      };

      listEl.appendChild(row);
    });
  }

  function updateStats() {
    const done = Object.values(visited).filter(Boolean).length;
    statsEl.innerHTML = `Visited <b>${done}</b> / <b>${plants.length}</b>`;
  }

  function escapeHtml(s) {
    return String(s)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // --- EVENTS ---
  document.getElementById("clearVisited").onclick = () => {
    if (confirm("Reset all visited?")) {
      visited = {};
      saveVisited();
      selectedId = null;
      hintEl.textContent = "";
      buildList();
      updateStats();
    }
  };
</script>
</body>
</html>
